# 초성 검색 앱 PRD (Product Requirements Document)

## 1. 프로젝트 개요

### 1.0 사이트 정보
- **사이트 이름**: ㅋㅋㅋ

### 1.1 목적
사용자가 입력한 초성을 데이터베이스와 매칭하여 실시간으로 검색 결과를 제공하는 웹 애플리케이션

### 1.2 핵심 기능
- 초성 입력 필드를 통한 실시간 검색
- 구글 시트 기반 데이터베이스 연동
- 초성 검색 및 부분 일치 검색
- 카테고리별 필터링
- 태그별 필터링 (다중 태그 지원)
- 검색 히스토리
- 검색 결과 클립보드 복사
- 로컬 스토리지를 통한 설정 저장
- 성능 최적화 (대량 데이터 처리)

---

## 2. 기능 요구사항

### 2.1 초성 입력 및 실시간 검색

#### 2.1.1 초성 입력 필드
- 사용자가 직접 초성을 입력할 수 있는 텍스트 입력 필드 제공
- 입력 필드에 한글 자음(`ㄱ`~`ㅎ`)과 공백만 허용
- 입력 즉시 실시간으로 검색 수행

#### 2.1.2 실시간 검색
- 사용자가 초성을 입력하는 동안 실시간으로 검색 결과 업데이트
- 입력이 변경될 때마다 자동으로 검색 수행
- 디바운싱 적용으로 과도한 검색 방지 (선택사항)

### 2.2 데이터베이스 연동

#### 2.2.1 구글 시트 연동 (읽기)
- **형식**: CSV 형식으로 게시된 구글 시트 URL 사용
- **기본 URL**: `https://docs.google.com/spreadsheets/d/e/2PACX-1vTNgKTsKcqDr4etDeuMtzfJqlFDfsDuCTRA3AgGdUtaIimSGV6Jc-kUO2zEEUf3MJbfic_21tnjo3oz/pub?output=csv`
- **구조**:
  - A열: 카테고리 (예: 게임, 영화, 인물, 식물, 동물)
  - B열: 태그 (예: 바람의나라, 리니지 등) - 쉼표로 구분하여 다중 태그 가능, 선택사항
  - C열: 이름
  - 첫 번째 행은 헤더로 처리 (카테고리, 태그, 이름)
- **데이터 로딩**: 앱 시작 시 비동기 로드
- **데이터 새로고침**: 사용자가 수동으로 새로고침 버튼을 클릭하여 최신 데이터 로드 가능

#### 2.2.2 구글 시트 연동 (쓰기 - 추가 기능)
- **방법**: Google Apps Script 웹 앱 엔드포인트 사용
- **URL**: Apps Script에서 배포한 웹 앱 URL
- **요청**: POST 방식으로 카테고리와 이름 전송
- **응답**: 성공/실패 여부 반환

#### 2.2.3 초성 변환
- 각 이름(C열)에 대해 초성을 자동 생성
- 저장 구조:
  ```javascript
  {
    t: "카테고리",      // category
    tags: ["태그1", "태그2"],  // tags (배열, 선택사항)
    n: "이름",          // name
    c: "ㄱㅊㅌㄱ"       // choseong (초성)
  }
  ```
- **태그 처리**: B열이 비어있으면 빈 배열로 처리 (하위 호환성)
- **다중 태그**: 쉼표로 구분된 태그를 배열로 변환

### 2.3 검색 기능

#### 2.3.1 검색 방식
- **부분 일치 검색**: 입력한 초성이 포함된 모든 결과 반환
- **예시**: `ㄱㅊ` 검색 → `강철`, `강철투구`, `연강철` 등 모두 출력
- **실시간 검색**: 사용자가 초성을 입력하는 동안 실시간으로 검색 결과 업데이트

#### 2.3.2 검색 결과 표시
- 카테고리와 이름을 함께 표시
- 형식: `[카테고리] 이름`
- 결과 목록 형태로 출력
- **검색 결과가 없을 때**: "검색 결과가 없습니다" 메시지 표시
- 검색 결과 개수 표시 (선택사항): "총 N개 결과" 형식

#### 2.3.3 검색 결과 클릭 기능
- 검색 결과 항목(이름)을 클릭 가능하게 표시
- 클릭 시 해당 이름을 클립보드에 복사
- 복사 완료 시 사용자에게 알림 표시 (예: "클립보드에 복사되었습니다")
- 예시: "강철투구" 클릭 → 클립보드에 "강철투구" 복사

#### 2.3.4 카테고리별 필터링
- 검색 결과를 카테고리별로 필터링 가능
- 전체 카테고리 목록 표시
- 특정 카테고리 선택 시 해당 카테고리의 결과만 표시
- "전체" 옵션으로 모든 결과 표시

#### 2.3.5 태그별 필터링
- 카테고리를 선택하면 해당 카테고리의 태그 목록이 자동으로 표시됨
- 태그는 선택사항이며, 선택하지 않아도 검색 가능
- 다중 태그 선택 가능 (체크박스 형태)
- 태그 옆에 아이템 개수 표시 (예: "바람의나라 (1,234)")
- "전체" 옵션으로 태그 필터 해제
- 태그가 없는 카테고리에서는 태그 필터가 표시되지 않음
- 필터링 순서: 카테고리 → 태그 → 초성 검색 (성능 최적화)

### 2.4 검색 히스토리

#### 2.4.1 히스토리 저장
- 검색한 초성 문자열을 자동으로 저장
- 로컬 스토리지에 저장하여 다음 접속 시에도 유지

#### 2.4.2 히스토리 표시
- 최근 검색어 목록 표시
- 히스토리 항목 클릭 시 해당 검색어로 재검색

#### 2.4.3 히스토리 관리
- 개별 항목 삭제 기능
- 전체 히스토리 삭제 기능

### 2.5 정답 등록 기능 (추가 기능)

#### 2.5.1 등록 트리거
- 검색 결과 영역에 항상 "정답 등록" 버튼 표시
- 검색 결과가 없을 때뿐만 아니라, 검색 결과가 있어도 원하는 항목이 없을 때 등록 가능
- 사용자가 수동으로 이름과 카테고리를 입력하여 등록

#### 2.5.2 카테고리 자동 설정 알고리즘
- **우선순위 1**: 정확 일치 항목 확인
  - 새로 등록하는 이름과 기존 데이터베이스의 이름이 정확히 일치하는 항목이 있으면 해당 카테고리 자동 선택
- **우선순위 2**: 최근 검색 카테고리
  - 정확 일치가 없으면 사용자가 최근에 검색한 결과의 카테고리를 기본값으로 사용
- **우선순위 3**: 가장 빈번한 카테고리
  - 최근 검색 이력이 없으면 데이터베이스에서 가장 많은 항목이 있는 카테고리를 기본값으로 사용
- **사용자 수정 가능**: 자동 설정된 카테고리를 드롭다운으로 표시하고 사용자가 수정 가능

#### 2.5.3 스팸 등록 방지

##### 2.5.3.1 중복 등록 방지
- 등록 전 기존 데이터베이스에서 동일한 이름이 이미 존재하는지 확인
- 중복된 이름이 있으면 등록 거부 및 사용자에게 알림
- 예시: "강철투구"가 이미 있으면 "이미 등록된 항목입니다" 메시지 표시

##### 2.5.3.2 등록 제한
- **IP당 시간당 제한**: 동일 IP 주소에서 1시간에 등록할 수 있는 최대 개수 제한
  - 기본값: IP당 시간당 10개 (설정 가능)
  - 열성 유저의 정상적인 사용을 고려하여 적절한 수준으로 설정
- 제한 초과 시 사용자에게 알림 및 등록 거부

##### 2.5.3.3 입력 검증
- **이름 검증**:
  - 빈 문자열 방지
  - 최대 길이 제한: 200자
  - **한글만 허용**: 한글 완성형 문자만 입력 가능 (영어, 숫자, 특수문자 제외)
  - 정규식으로 한글 유니코드 범위(`\uAC00-\uD7A3`) 검증
- **카테고리 검증**:
  - 기존 카테고리 목록에 있는 카테고리만 허용 (드롭다운으로 제한)
  - 새 카테고리 생성 불가

##### 2.5.3.4 등록 이력 추적
- 등록 시 **타임스탬프 기록** (ISO 8601 형식 또는 Unix timestamp)
- IP 주소 기록
- 등록 요청 상태 기록 (대기 중, 승인됨, 거부됨)
- 비정상적인 등록 패턴 감지 (예: 짧은 시간에 대량 등록)

##### 2.5.3.5 자동 승인 시스템 (Google Gemini API)
- **등록 신청 시트**: 등록 요청을 별도의 "등록신청" 시트에 저장
  - 구조: 타임스탬프, IP 주소, 카테고리, 이름, 상태(대기 중/승인됨/거부됨), 승인 여부 로그
- **Google Gemini API를 활용한 자동 검토**:
  - **사용 모델**: Gemini 2.5 Flash
  - 등록 요청이 들어오면 Gemini API에 검토 요청
  - 프롬프트: "다음 항목이 게임 아이템 이름으로 적절한지 검토해주세요. 카테고리: {카테고리}, 이름: {이름}. 승인 또는 거부 중 하나로만 답변하고, 간단한 이유를 설명해주세요."
  - API 응답 파싱:
    - 응답에서 "승인", "거부", "approve", "reject" 등의 키워드 추출
    - 승인 키워드가 포함되면 승인, 거부 키워드가 포함되면 거부
    - 키워드가 명확하지 않으면 기본적으로 거부 (안전 우선)
  - 승인 여부와 검토 이유를 로그로 기록
- **승인된 항목 처리**:
  - 승인된 항목은 자동으로 메인 시트에 추가
  - 등록신청 시트의 상태를 "승인됨"으로 업데이트
- **거부된 항목 처리**:
  - 거부된 항목은 등록신청 시트에만 남김
  - 상태를 "거부됨"으로 업데이트하고 거부 사유 기록

##### 2.5.3.6 API 사용량 제한
- **일간 토큰 제한**: 사이트 전체에서 하루에 사용할 수 있는 Gemini API 토큰 제한
  - **일간 제한량**: 100,000 토큰
  - 일일 토큰 사용량 추적
  - 토큰 제한에 도달하면 새로운 등록 요청은 대기 상태로 유지
  - 관리자에게 토큰 부족 알림
  - **매일 자정에 일일 사용량 리셋**:
    - Apps Script의 Time-driven Trigger 사용
    - 매일 00:00 (자정)에 실행되는 트리거 설정
    - 일일 사용량을 0으로 리셋하고 토큰사용량 시트에 새 행 추가
- **요청당 토큰 추적**: 각 등록 요청에 사용된 토큰 수 기록
  - Gemini API 응답에서 `usageMetadata.totalTokenCount` 추출
- **토큰 사용량 모니터링**: 현재 사용량과 남은 토큰 표시 (관리자용)

##### 2.5.3.7 운영자 토큰 사용량 조회
- **구글 시트를 통한 조회**:
  - "토큰사용량" 시트에 일일 토큰 사용량 기록
  - 구조: 날짜, 사용된 토큰 수, 남은 토큰 수, 사용률(%)
  - 운영자는 구글 시트에서 직접 확인 가능
- **Apps Script API를 통한 조회**:
  - `doGet` 함수로 GET 요청 시 현재 토큰 사용량 반환
  - 응답 형식: JSON
  - 운영자 전용 엔드포인트 (API 키 또는 인증 필요)
  - 실시간 토큰 사용량 조회 가능
- **토큰 사용량 시트 구조**:
  - A열: 날짜 (YYYY-MM-DD)
  - B열: 사용된 토큰 수
  - C열: 남은 토큰 수 (100,000 - 사용된 토큰)
  - D열: 사용률 (%)
  - E열: 리셋 시간

#### 2.5.4 구글 시트 연동
- **시트 구조**:
  - **메인 시트**: 승인된 최종 데이터 (A열: 카테고리, B열: 이름)
  - **등록신청 시트**: 등록 요청 목록
    - A열: 타임스탬프
    - B열: IP 주소
    - C열: 카테고리
    - D열: 이름
    - E열: 상태 (대기 중/승인됨/거부됨)
    - F열: 승인 여부 로그 (Gemini API 검토 결과)
    - G열: 사용된 토큰 수 (각 요청당)
  - **토큰사용량 시트**: 일일 토큰 사용량 기록
    - A열: 날짜 (YYYY-MM-DD)
    - B열: 사용된 토큰 수
    - C열: 남은 토큰 수
    - D열: 사용률 (%)
    - E열: 리셋 시간
- **방법**: Google Apps Script 웹 앱 사용
- **구현**:
  - Apps Script에서 `doPost` 함수로 POST 요청 받기
  - **IP 주소 추출**: `e.parameter` 또는 요청 헤더에서 IP 주소 추출
    - `e.parameter.sourceIp` 또는 헤더 `X-Forwarded-For` 사용
  - 스팸 방지 로직 적용 (중복 확인, IP당 시간당 제한 확인, 입력 검증 등)
  - 등록 요청을 "등록신청" 시트에 저장 (상태: 대기 중)
  - Google Gemini API를 호출하여 자동 검토 수행
  - 승인된 항목은 메인 시트에 추가하고 등록신청 시트 상태 업데이트
  - 거부된 항목은 등록신청 시트에만 남김
  - CORS 헤더 설정으로 스태틱 사이트에서 호출 가능
    - `Access-Control-Allow-Origin: *` 또는 특정 도메인 지정
- **권한**: 시트 소유자 또는 편집 권한이 있는 계정으로 스크립트 작성/배포 필요
- **보안**: 웹 앱 배포 시 "익명 사용자" 또는 특정 사용자만 허용 설정
- **Gemini API 연동**:
  - Apps Script에서 Gemini API 호출
  - **사용 모델**: Gemini 2.5 Flash
  - API 키는 Apps Script의 Properties Service에 안전하게 저장
  - 토큰 사용량 추적 및 제한 관리 (일간 100,000 토큰 제한)
  - 각 API 호출 후 사용된 토큰 수를 "토큰사용량" 시트에 기록
- **운영자 조회 API**:
  - `doGet` 함수로 GET 요청 시 현재 토큰 사용량 반환
  - 요청 형식: `GET /exec?action=getTokenUsage`
  - 응답 형식: JSON
    ```json
    {
      "date": "2025-01-XX",
      "tokensUsed": 12345,
      "tokensRemaining": 87655,
      "usageRate": 12.35,
      "limit": 100000
    }
    ```
  - 인증: API 키 또는 관리자 인증 필요

#### 2.5.5 등록 후 처리
- 등록 요청 제출 시 사용자에게 "등록 신청이 접수되었습니다. 검토 후 승인됩니다." 메시지 표시
- 승인된 항목은 메인 시트에 추가되며, 다음 데이터 로딩 시 검색 가능
- 거부된 항목은 사용자에게 알림하지 않음 (등록신청 시트에서만 확인 가능)
- 등록 요청 상태 확인 기능 (선택사항): 사용자가 자신의 등록 요청 상태를 확인할 수 있는 기능

### 2.6 설정 관리

#### 2.6.1 로컬 스토리지 초기화
- 모든 저장된 설정을 초기화하는 기능 제공
- 버튼 또는 메뉴 항목으로 구현

---

## 3. 기술 스택

### 3.1 핵심 기술
- **HTML5**: 기본 구조
- **JavaScript (ES6+)**: 로직 구현
- **Clipboard API**: 클립보드 복사 기능
- **LocalStorage API**: 설정 저장

### 3.2 외부 의존성
- 구글 시트 CSV 게시 링크
- Google Gemini API (정답 등록 자동 검토용)

---

## 4. 사용자 인터페이스

### 4.0 디자인 스타일
- **색상**: 흑백 UI (검은색과 흰색만 사용)
- **글씨체**: 도트 형식 글씨체 (픽셀 폰트 스타일)
- **전체적인 느낌**: 레트로 게임 스타일의 미니멀한 디자인

### 4.1 주요 UI 요소

#### 4.1.1 초성 입력 영역
- 초성 입력 필드
- 실시간 검색 안내 텍스트

#### 4.1.2 검색 결과 영역
- 검색 결과 목록
- 각 결과: `[카테고리] 이름` 형식
- 이름 부분 클릭 가능 (클립보드 복사)
- 카테고리 필터 버튼/드롭다운
- "정답 등록" 버튼 (항상 표시)
- 데이터 새로고침 버튼 (최신 데이터 로드)

#### 4.1.3 검색 히스토리 영역
- 최근 검색어 목록
- 검색어 클릭으로 재검색
- 개별/전체 삭제 버튼

#### 4.1.4 정답 등록 모달/패널
- "정답 등록" 버튼 클릭 시 표시
- 이름 입력 필드
- 카테고리 선택 드롭다운 (자동 설정된 값 표시, 수정 가능)
- 등록 버튼
- 취소 버튼

#### 4.1.5 설정 영역
- 로컬 스토리지 초기화 버튼
- 구글 시트 URL 입력 필드

#### 4.1.6 운영자 대시보드 (관리자용)
- **접근 방법**: URL 파라미터 또는 로컬 스토리지에 관리자 플래그 설정
  - 예: `?admin=true` 또는 로컬 스토리지에 `isAdmin: true` 설정
  - 관리자 모드 활성화 시에만 표시
- 토큰 사용량 표시 영역
  - 현재 일일 사용량
  - 남은 토큰 수
  - 사용률 (%)
  - 실시간 업데이트 (선택사항)
- 토큰 사용량 조회 버튼
  - Apps Script API를 통해 최신 사용량 조회
- 구글 시트 링크
  - "토큰사용량" 시트로 직접 이동

### 4.2 상태 표시
- 데이터 로딩 중: "데이터 로딩 중..." (로딩 스피너 표시)
- 데이터 로딩 완료: "데이터 로딩 완료!" (일시적으로 표시 후 사라짐)
- 데이터 로딩 실패: "데이터를 불러올 수 없습니다. 다시 시도해주세요."
- 검색 결과 없음: "검색 결과가 없습니다"
- 오류 발생 시: 적절한 오류 메시지 표시
  - 네트워크 오류: "네트워크 연결을 확인해주세요"
  - 등록 실패: 구체적인 실패 사유 표시 (중복, 제한 초과, 검증 실패 등)

---

## 5. 데이터 구조

### 5.1 데이터베이스 항목
```javascript
{
  t: string,      // 카테고리 (category)
  tags: string[], // 태그 배열 (선택사항)
  n: string,      // 이름 (name)
  c: string       // 초성 (choseong)
}
```

### 5.2 로컬 스토리지 구조
```javascript
{
  googleSheetUrl: string,        // 구글 시트 URL (선택사항)
  searchHistory: string[],       // 검색 히스토리 배열
  lastSearchedCategory: string   // 최근 검색한 카테고리 (자동 설정용)
}
```

### 5.3 정답 등록 요청 구조
```javascript
{
  category: string,  // 카테고리
  name: string       // 이름
}
```

### 5.4 등록신청 시트 구조
```javascript
{
  timestamp: string,     // 타임스탬프 (ISO 8601 형식)
  ipAddress: string,     // IP 주소
  category: string,      // 카테고리
  name: string,          // 이름
  status: string,        // 상태: "대기 중" | "승인됨" | "거부됨"
  reviewLog: string      // 승인 여부 로그 (Gemini API 검토 결과)
}
```

### 5.5 API 토큰 사용량 추적 구조
```javascript
{
  dailyTokensUsed: number,    // 일일 사용된 토큰 수
  dailyTokenLimit: number,    // 일일 토큰 제한량 (100,000)
  lastResetDate: string       // 마지막 리셋 날짜
}
```

### 5.6 토큰사용량 시트 구조
```javascript
{
  date: string,              // 날짜 (YYYY-MM-DD)
  tokensUsed: number,        // 사용된 토큰 수
  tokensRemaining: number,   // 남은 토큰 수
  usageRate: number,         // 사용률 (%)
  resetTime: string          // 리셋 시간
}
```

---

## 6. 초성 변환 로직

### 6.1 한글 초성 추출
- 유니코드 범위: `0xAC00` ~ `0xD7A3` (한글 완성형)
- 초성 인덱스 계산: `(코드 - 0xAC00) / 588`
- 초성 리스트: `["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"]`

### 6.2 비한글 문자 처리
- 한글이 아닌 문자는 그대로 유지

---

## 7. 검색 알고리즘

### 7.1 부분 일치 검색
- 입력된 초성 문자열이 데이터베이스 항목의 초성(`c` 필드)에 포함되는지 확인
- `String.includes()` 메서드 사용

### 7.2 카테고리별 필터링
- 검색 결과를 카테고리(`t` 필드) 기준으로 필터링
- 사용자가 선택한 카테고리와 일치하는 항목만 표시
- "전체" 선택 시 필터링 없이 모든 결과 표시

### 7.3 태그별 필터링
- 카테고리 선택 시 해당 카테고리의 태그 목록 자동 수집
- 선택한 태그(`tags` 필드)가 포함된 항목만 표시
- 다중 태그 선택 시 OR 조건 (선택한 태그 중 하나라도 포함되면 표시)
- 태그가 없는 항목은 태그 필터 적용 시 제외
- 필터링 순서: 카테고리 → 태그 → 초성 검색 (성능 최적화)

### 7.4 검색 결과 정렬
- 정렬 기준: 데이터 순서 (구글 시트 순서 유지)
- 검색 결과 제한: 최대 500개까지만 표시 (성능 보호)

---

## 8. 예외 처리

### 8.1 데이터 로딩 실패
- 구글 시트 URL 오류 시 사용자에게 알림
- 네트워크 오류 처리

### 8.2 클립보드 복사 실패
- 클립보드 API 권한이 없는 경우 처리
- 오류 메시지 표시

### 8.3 정답 등록 실패
- Google Apps Script 웹 앱 연결 실패 처리
- 네트워크 오류 처리
- 시트 권한 오류 처리
- 중복 등록 시도 시 오류 메시지
- IP당 시간당 등록 제한 초과 시 오류 메시지
- 입력 검증 실패 시 오류 메시지 (한글만 허용, 최대 200자)
- Google Gemini API 호출 실패 처리
- API 토큰 제한 초과 시 오류 메시지 및 대기 상태 안내
- Google Apps Script 실행 시간 초과 (6분 제한) 처리
  - 일반적으로 발생하지 않지만, Gemini API 응답이 매우 느린 경우 대비
  - 타임아웃 발생 시 사용자에게 재시도 안내
- 사용자에게 적절한 오류 메시지 표시

---

## 9. 성능 요구사항

### 9.1 실시간 검색
- 검색 결과 업데이트: 입력 후 100ms 이내 (디바운싱 적용 시)
- 대량 데이터에서도 부드러운 검색 경험 제공

### 9.2 데이터 로딩
- 구글 시트 데이터 로딩: 네트워크 속도에 의존
- 로딩 중 상태 표시 필수

---

## 10. 보안 및 개인정보

### 10.1 데이터 저장
- 모든 데이터는 로컬 스토리지에만 저장
- 서버로 전송하지 않음

### 10.2 클립보드 접근
- 클립보드 복사 시 사용자 명시적 동작 필요 (클릭)
- 클립보드 API 권한 요청 (필요한 경우)

### 10.3 스팸 등록 방지
- 등록 요청에 대한 검증 및 제한 적용
- 중복 등록 방지
- IP당 시간당 등록 제한
- 한글만 허용하는 입력 검증
- 등록 이력 추적 (타임스탬프, IP 주소 기록)
- Google Gemini API를 활용한 자동 검토 및 승인
- API 토큰 사용량 제한으로 비용 관리

---

## 11. 향후 확장 가능성

### 11.1 추가 기능 (선택사항)
- 검색 결과 정렬 옵션 (알파벳 순, 관련도 등)
- 검색 결과 개수 제한 설정

---

## 12. 개발 우선순위

### Phase 1 (MVP - 최소 기능 제품)
1. 구글 시트 데이터 로딩
2. 초성 변환 및 검색 기능
3. 초성 입력 필드 및 실시간 검색
4. 기본 UI 구성

### Phase 2 (핵심 기능)
1. 검색 결과 표시
2. 검색 결과 클립보드 복사 기능
3. 카테고리별 필터링

### Phase 3 (사용성 개선)
1. 검색 히스토리 기능
2. 로컬 스토리지 저장/복원
3. 설정 UI
4. 오류 처리 강화

### Phase 4 (추가 기능)
1. 정답 등록 기능
2. 카테고리 자동 설정 알고리즘
3. Google Apps Script 웹 앱 연동
4. 등록신청 시트 분리 및 관리
5. 스팸 등록 방지 기능 (중복 확인, IP당 시간당 제한, 한글만 허용, 최대 200자 제한)
6. 타임스탬프 및 IP 주소 기록
7. Google Gemini API 연동 및 자동 검토 시스템
8. API 토큰 사용량 추적 및 제한 관리

---

## 13. 테스트 시나리오

### 13.1 기능 테스트
- 구글 시트 데이터 로딩 테스트
- 초성 변환 정확도 테스트
- 부분 일치 검색 테스트
- 실시간 검색 동작 테스트
- 카테고리별 필터링 테스트
- 태그별 필터링 테스트
- 성능 최적화 테스트 (대량 데이터)
- 검색 히스토리 저장/복원 테스트
- 검색 결과 클립보드 복사 테스트
- 정답 등록 기능 테스트
- 카테고리 자동 설정 알고리즘 테스트
- Google Apps Script 웹 앱 연동 테스트
- 중복 등록 방지 테스트
- IP당 시간당 등록 제한 동작 테스트
- 입력 검증 테스트 (한글만 허용, 최대 200자)
- 타임스탬프 및 IP 주소 기록 테스트
- 등록신청 시트 저장 테스트
- Google Gemini API 연동 테스트
- 자동 승인/거부 로직 테스트
- 승인 여부 로그 기록 테스트
- API 토큰 사용량 추적 테스트
- API 토큰 제한 초과 시 동작 테스트
- 토큰사용량 시트 기록 테스트
- 운영자 토큰 사용량 조회 API 테스트
- 구글 시트를 통한 토큰 사용량 확인 테스트

### 13.2 사용성 테스트
- 로컬 스토리지 저장/복원 테스트
- 다양한 브라우저 호환성 테스트
- 클립보드 API 권한 테스트

---

## 14. 참고사항

### 14.1 구글 시트 설정
- 시트를 "웹에 게시" 설정 필요
- CSV 형식으로 내보내기 링크 사용
- 기본 구글 시트 URL: `https://docs.google.com/spreadsheets/d/e/2PACX-1vTNgKTsKcqDr4etDeuMtzfJqlFDfsDuCTRA3AgGdUtaIimSGV6Jc-kUO2zEEUf3MJbfic_21tnjo3oz/pub?output=csv`
- **시트 구조**:
  - A열: 카테고리 (게임, 영화, 인물, 식물, 동물 등)
  - B열: 태그 (바람의나라, 리니지 등) - 쉼표로 구분하여 다중 태그 가능, 선택사항
  - C열: 이름
- **태그 입력 방법**: 쉼표로 구분 (예: "바람의나라,MMORPG")
- **하위 호환성**: 태그가 없는 데이터도 정상 작동

### 14.2 브라우저 호환성
- Clipboard API: Chrome 66+, Edge 79+, Firefox 63+, Safari 13.1+
- 모든 모던 브라우저 지원

### 14.3 호스팅

#### 14.3.1 호스팅 플랫폼
- **권장 플랫폼**: Render.com (무료 스태틱 사이트 호스팅 지원)
  - 무료 플랜으로 스태틱 사이트 호스팅 가능
  - GitHub 저장소 연동으로 자동 배포
  - 무료 SSL 인증서 및 HTTPS 지원 (Clipboard API 사용을 위해 필수)
  - URL 형식: `{사이트명}.onrender.com`
- **대안 플랫폼**:
  - Netlify: 무료 스태틱 호스팅, 자동 HTTPS, GitHub 연동
  - Vercel: 무료 스태틱 호스팅, 자동 HTTPS, GitHub 연동
  - GitHub Pages: 무료 스태틱 호스팅, GitHub 저장소 필수

#### 14.3.2 호스팅 요구사항
- **HTTPS 필수**: Clipboard API 사용을 위해 HTTPS 환경 필요 (localhost 제외)
- **CORS 설정**: Google Apps Script 웹 앱에서 CORS 헤더 설정 필요
  - `Access-Control-Allow-Origin` 헤더에 호스팅 도메인 추가
- **정적 파일 호스팅**: HTML, CSS, JavaScript 파일만 필요 (서버 사이드 로직 없음)
- **외부 API 호출**: 
  - Google Sheets CSV 읽기 (CORS 허용 필요)
  - Google Apps Script 웹 앱 호출 (POST 요청, CORS 설정 필요)

#### 14.3.3 배포 방식
- GitHub 저장소에 코드 푸시
- Render.com (또는 다른 플랫폼)에서 저장소 연동
- 자동 빌드 및 배포
- 환경 변수 설정 (필요한 경우)

### 14.4 제약사항
- Clipboard API는 HTTPS 환경에서만 사용 가능 (localhost 제외)
- **Google Apps Script 실행 시간 제한**: 
  - 한 번의 함수 실행(요청 처리)이 **최대 6분**을 초과하면 자동으로 타임아웃됨
  - 이 프로젝트의 경우 등록 요청 처리(검증, Gemini API 호출, 시트 저장)는 일반적으로 **몇 초 내에 완료**되므로 문제 없음
  - 다만 Gemini API 응답이 매우 느리거나 네트워크 지연이 심한 경우를 대비해 타임아웃 처리 필요
- 정답 등록 기능은 시트 편집 권한이 있는 계정으로 Apps Script 배포 필요
- Google Gemini API 사용량 제한 및 비용 관리 필요
  - 일간 100,000 토큰 제한
  - 사용 모델: Gemini 2.5 Flash
- API 토큰 제한에 도달하면 새로운 등록 요청은 대기 상태로 유지됨
- 등록신청 시트와 메인 시트를 별도로 관리하여 데이터 분리
- Render.com 무료 플랜의 경우 URL에 `onrender.com` 도메인 사용 (커스텀 도메인은 유료 플랜 필요)

---

## 15. 용어 정의

- **초성**: 한글 자음 (ㄱ, ㄴ, ㄷ, ...)
- **실시간 검색**: 사용자가 입력하는 동안 즉시 검색 결과를 업데이트하는 방식
- **Gemini API**: Google의 생성형 AI API로 등록 요청의 적절성을 자동으로 검토
- **토큰**: AI API 호출 시 사용되는 단위로, 입력과 출력의 길이에 따라 소비됨

---

**문서 버전**: 1.0  
**작성일**: 2025  
**최종 수정일**: 2025

